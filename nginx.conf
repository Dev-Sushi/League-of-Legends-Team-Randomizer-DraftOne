
# nginx.conf for Team Randomizer

# Defines a group of servers. In this case, just our Node.js app.
upstream app_server {
    # The server is running on localhost port 7778
    server 192.168.2.101:7778;
}

server {
    # Listen on port 80 for incoming connections
    listen 80;
    
    # Replace with your domain name or server's IP address
    server_name draftone.dev-sushi.com;

    # Path to your project's root directory on the server where Nginx is running.
    # IMPORTANT: You MUST change this to the correct absolute path on your server.
    # Example for Linux: /var/www/team-randomizer
    root "C:/Users/lukas/Desktop/Code/Team Randomizer/Team Randomizer";

    # Default file to serve
    index index.html;

    # Location for all requests
    location / {
        # Try to serve the requested file directly. If it's a directory, try the directory.
        # If neither exists, pass the request to our Node.js application.
        try_files $uri $uri/ @nodejs;
    }

    # Location for the WebSocket connection
    location /socket.io/ {
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_set_header X-NginX-Proxy true;

        proxy_pass http://app_server;
        proxy_redirect off;

        # Required for WebSocket proxying
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    # Named location for proxying to the Node.js app
    location @nodejs {
        proxy_pass http://app_server;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_set_header X-NginX-Proxy true;
        proxy_redirect off;

        # Required for WebSocket proxying
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
